# 更新日志

## [未发布] - 2025-10-21

### 重大变更 🚨

#### 数据更新策略调整

**问题背景**：
- 前复权数据会随除权除息事件动态调整
- 增量更新导致新旧数据使用不同复权基准
- 造成数据不连续，指数计算错误

**解决方案**：
- 改用全量刷新策略：每次更新删除旧数据，重新下载全部历史数据
- 确保所有数据使用统一的复权基准（当前时刻）
- 保证数据连续性和指数计算准确性

**影响**：
- ⚠️ 每次数据更新需要10-30分钟
- ✅ 数据质量显著提升
- ✅ 指数计算更加准确

### 新增功能 ✨

- **`DataDownloader.full_refresh_data()`**: 全量刷新数据方法
- **`ParquetStorage.delete_stock_data()`**: 删除股票数据方法
- **配置项**: 支持 `mode: refresh` 明确指定全量刷新

### 修改 🔧

- **数据下载器**: 默认更新模式改为全量刷新
- **增量更新**: 标记为已弃用，自动重定向到全量刷新
- **配置说明**: 更新 `mode` 参数的说明

### 文档 📚

- 新增 `docs/数据更新策略说明.md`
- 详细说明前复权数据特性和解决方案
- 提供使用方法和最佳实践

### 技术细节

**修改的文件**：
- `src/dwad/tools/data_downloader.py`
  - 新增 `full_refresh_data()` 方法
  - 修改 `update_recent_data()` 重定向到全量刷新
  - 新增 `_refresh_batch_silent()` 批量刷新方法
  - 更新 `main()` 函数的模式判断逻辑

- `src/dwad/data_storage/parquet_storage.py`
  - 新增 `delete_stock_data()` 方法
  - 更新 `append_stock_data()` 添加弃用说明

---

## [阶段一完成] - 2025-10-15

### 功能完成 ✅

#### 实时价格功能
- 实时价格获取器 `RealtimePriceFetcher`
- 实时指数排名计算
- 可视化图表实时数据显示（虚线）
- 多周期实时数据支持

#### 指数比较功能
- 单周期指数比较
- 多周期指数比较（20、55、233日）
- 排名趋势可视化
- HTML交互式报告

#### 数据管理
- 股票数据下载和存储
- 指数计算和缓存
- Parquet格式数据存储
- 断点续传支持

### 已知问题 ⚠️

1. **实时价格与日线数据不一致**
   - 原因：实时价格不复权 vs 日线数据前复权
   - 状态：已分析，暂时接受该误差
   
2. **前复权数据连续性问题**
   - 原因：增量更新使用不同复权基准
   - 状态：已修复（采用全量刷新策略）

---

## 版本规划

### 当前版本：阶段一
- ✅ 基础数据获取
- ✅ 指数计算
- ✅ 排名分析
- ✅ 可视化展示
- ✅ 实时价格功能
- ✅ 数据连续性修复

### 下一阶段计划
- 📋 更多技术指标
- 📋 策略回测框架
- 📋 性能优化
- 📋 Web界面
