# 指数计算配置示例

## 配置文件位置
`config/config.yaml`

---

## 场景1：使用统一的指数起始日期

### 需求
所有股池指数都从 2020-01-01 开始计算，便于横向对比。

### 配置
```yaml
index_calculator:
  base_value: 1000.0
  start_date: "2020-01-01"
```

### 效果
```
指数起始日期（配置）: 2020-01-01
  指数起始日（配置）: 2020-01-01
  ⚠️  股票 SZSE.300750 上市日期 2023-06-01 晚于指数起始日 2020-01-01，已排除
  实际参与指数计算的股票数: 4/5
  ✓ 指数计算完成，共 1234 个交易日
```

**优势**：
- 所有指数从同一天开始，便于对比
- 涨跌幅可以直接比较

---

## 场景2：自动使用最早日期

### 需求
每个股池使用各自成分股的最早数据，最大化数据利用。

### 配置
```yaml
index_calculator:
  base_value: 1000.0
  start_date: null  # 或者删除这一行
```

### 效果
```
指数起始日期：使用数据中最早的交易日
  指数起始日（自动）: 2015-01-05
  实际参与指数计算的股票数: 5/5
  ✓ 指数计算完成，共 2456 个交易日
```

**优势**：
- 最大化利用历史数据
- 所有成分股都参与计算

---

## 场景3：自定义指数基准值

### 需求
指数从100点开始，更接近百分比的概念。

### 配置
```yaml
index_calculator:
  base_value: 100.0
  start_date: "2020-01-01"
```

### 效果
```
指数基准值: 100.0

数据示例:
日期        指数值
2020-01-01  100.00
2020-01-02  102.50   (+2.5%)
2020-01-03  98.75    (-3.7%)
```

---

## 场景4：混合配置对比

### 配置A：长期历史指数
```yaml
index_calculator:
  base_value: 1000.0
  start_date: null  # 使用最早数据
```

### 配置B：近期表现指数
```yaml
index_calculator:
  base_value: 1000.0
  start_date: "2024-01-01"  # 只看今年
```

### 用途
- 配置A：分析长期趋势
- 配置B：分析短期表现

---

## 配置验证

### 检查点1：起始日期是否合理

**情况1**：配置日期早于数据
```
配置: start_date: "2010-01-01"
数据: 最早 2020-01-01

结果:
⚠️ 配置的起始日期 2010-01-01 早于数据起始日 2020-01-01，将使用 2020-01-01
```

**情况2**：配置日期晚于数据
```
配置: start_date: "2025-01-01"
数据: 最晚 2024-12-31

结果:
❌ 配置的起始日期 2025-01-01 晚于数据结束日 2024-12-31，无法计算指数
```

### 检查点2：成分股数量

**正常情况**：
```
实际参与指数计算的股票数: 5/5
```

**有排除**：
```
⚠️ 股票 SZSE.300750 上市日期晚于指数起始日，已排除
实际参与指数计算的股票数: 4/5
```

**过多排除**：
```
⚠️ 共排除 8 只上市晚于指数起始日的股票
实际参与指数计算的股票数: 2/10
⚠️ 建议：调整起始日期或重新选择成分股
```

---

## 最佳实践

### 推荐配置1：标准配置
```yaml
index_calculator:
  base_value: 1000.0
  start_date: "2020-01-01"
```
- **适用**：大多数场景
- **优势**：数据较全，成分股稳定

### 推荐配置2：灵活配置
```yaml
index_calculator:
  base_value: 1000.0
  start_date: null
```
- **适用**：概念股池成分股上市时间差异大
- **优势**：最大化数据利用

### 推荐配置3：短期分析
```yaml
index_calculator:
  base_value: 1000.0
  start_date: "2024-01-01"
```
- **适用**：只关注近期表现
- **优势**：计算速度快，数据更新及时

---

## 配置修改流程

1. **编辑配置文件**
   ```bash
   notepad config/config.yaml
   ```

2. **修改参数**
   ```yaml
   index_calculator:
     base_value: 1000.0
     start_date: "2020-01-01"  # 修改这里
   ```

3. **重新计算指数**
   ```bash
   cd scripts
   python calculate_index.py
   ```

4. **检查日志输出**
   查看是否有警告或错误信息

---

## 常见问题

### Q1: 修改配置后需要重新下载数据吗？
**A**: 不需要。只需重新运行 `calculate_index.py`。

### Q2: 不同股池可以使用不同的起始日期吗？
**A**: 当前版本所有股池使用统一配置。如需不同起始日期，可以：
- 方案1：多次修改配置并分别计算
- 方案2：在代码中扩展支持每个股池独立配置

### Q3: 基准值 100 和 1000 有什么区别？
**A**: 只是显示数值不同，涨跌幅完全一致：
```
基准值 1000:  1000 → 1050  (+5%)
基准值 100:   100  → 105   (+5%)
```

### Q4: 如何查看实际使用了哪个起始日期？
**A**: 查看运行日志，会显示：
```
指数起始日（配置）: 2020-01-01
或
指数起始日（自动）: 2015-01-05
```

---

**更新日期**: 2025-10-11
