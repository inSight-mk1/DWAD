# è‚¡æ± æŒ‡æ•°æ¯”è¾ƒä½¿ç”¨è¯´æ˜

## ğŸ“– æ¦‚è¿°

è‚¡æ± æŒ‡æ•°æ¯”è¾ƒæ¨¡å—ç”¨äºå¯¹æ¯”åˆ†æå¤šä¸ªè‚¡æ± æŒ‡æ•°çš„è¡¨ç°ï¼Œè®¡ç®—æ¯ä¸ªäº¤æ˜“æ—¥çš„æ’åï¼Œå¹¶ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ•°æ®å½’ä¸€åŒ–
- ä»é…ç½®çš„æ¯”è¾ƒèµ·ç‚¹å½’ä¸€åŒ–æ‰€æœ‰æŒ‡æ•°åˆ°100åŸºç‚¹
- è‡ªåŠ¨å¤„ç†ä¸åŒæŒ‡æ•°èµ·å§‹æ—¥æœŸä¸åŒçš„æƒ…å†µ
- ç¡®ä¿æ‰€æœ‰æŒ‡æ•°ä»åŒä¸€èµ·ç‚¹è¿›è¡Œæ¯”è¾ƒ

### 2. æ’åè®¡ç®—
- åŸºäºæ¶¨è·Œå¹…è®¡ç®—æ¯ä¸ªäº¤æ˜“æ—¥çš„æ’å
- æ¶¨å¹…æœ€å¤§çš„æ’åç¬¬1ï¼Œæ¶¨å¹…æœ€å°çš„æ’åæœ€å
- è‡ªåŠ¨è¿½è¸ªæ’åå˜åŒ–è¶‹åŠ¿

### 3. å¯è§†åŒ–å±•ç¤º
- ç”Ÿæˆäº¤äº’å¼Webé¡µé¢æ˜¾ç¤ºæ’åè¶‹åŠ¿
- ä½¿ç”¨Plotlyå®ç°é«˜è´¨é‡å›¾è¡¨
- æ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€å¯¼å‡ºç­‰äº¤äº’æ“ä½œ

### 4. æ•°æ®å¯¼å‡º
- å¯¼å‡ºè¯¦ç»†æ’åæ•°æ®åˆ°CSVæ–‡ä»¶
- åŒ…å«æ¯æ—¥æ’åã€å½’ä¸€åŒ–å€¼ã€æ¶¨è·Œå¹…ç­‰ä¿¡æ¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

ç¡®ä¿å·²å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. ä¸‹è½½è‚¡ç¥¨æ•°æ®
cd scripts
python download_data.py

# 2. è®¡ç®—è‚¡æ± æŒ‡æ•°
python calculate_index.py
```

### åŸºæœ¬ä½¿ç”¨

```bash
# 3. æ¯”è¾ƒæŒ‡æ•°å¹¶ç”Ÿæˆå¯è§†åŒ–
cd scripts
python compare_indices.py
```

æ‰§è¡Œåä¼šç”Ÿæˆï¼š
- `reports/index_ranking_comparison.html` - æ’åè¶‹åŠ¿å¯è§†åŒ–é¡µé¢
- `reports/index_ranking_data.csv` - æ’åæ•°æ®CSVæ–‡ä»¶

ç”¨æµè§ˆå™¨æ‰“å¼€HTMLæ–‡ä»¶å³å¯æŸ¥çœ‹æ’åè¶‹åŠ¿å›¾ã€‚

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ä½ç½®

`config/index_comparison.yaml`

### é…ç½®é¡¹è¯¦è§£

#### 1. æ¯”è¾ƒèµ·å§‹æ—¥æœŸ

```yaml
comparison_start_date: "2024-09-18"
```

- **ä½œç”¨**ï¼šæ‰€æœ‰æŒ‡æ•°ä»æ­¤æ—¥æœŸå¼€å§‹å½’ä¸€åŒ–æ¯”è¾ƒ
- **å¯é€‰å€¼**ï¼š
  - æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆæ ¼å¼ï¼š`YYYY-MM-DD`ï¼‰
  - `null`ï¼šä½¿ç”¨æ‰€æœ‰æŒ‡æ•°ä¸­æœ€æ™šçš„èµ·å§‹æ—¥æœŸ
- **å»ºè®®**ï¼šè®¾ç½®ä¸ºæ‰€æœ‰æŒ‡æ•°éƒ½æœ‰æ•°æ®çš„æ—¥æœŸ

#### 2. éœ€è¦æ¯”è¾ƒçš„æŒ‡æ•°

```yaml
indices_to_compare:
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "æœºå™¨äººæ¦‚å¿µ"
    display_name: "æœºå™¨äºº"  # å¯é€‰
    
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "AIæ¦‚å¿µ"
    display_name: "AI"
```

- **pool_name**ï¼šè‚¡æ± åç§°ï¼ˆå¿…é¡»ä¸`stock_pools.yaml`ä¸­ä¸€è‡´ï¼‰
- **concept_name**ï¼šæ¦‚å¿µåç§°ï¼ˆå¿…é¡»ä¸`stock_pools.yaml`ä¸­ä¸€è‡´ï¼‰
- **display_name**ï¼šæ˜¾ç¤ºåç§°ï¼ˆå¯é€‰ï¼Œç”¨äºå›¾è¡¨ä¸­æ˜¾ç¤ºçš„ç®€çŸ­åç§°ï¼‰

#### 3. å¯è§†åŒ–é…ç½®

```yaml
visualization:
  title: "è‚¡æ± æŒ‡æ•°æ’åè¶‹åŠ¿"
  width: 1400
  height: 800
  show_markers: true
  line_width: 2
  show_grid: true
  output_filename: "index_ranking_comparison.html"
  output_dir: "reports"
```

- **title**ï¼šå›¾è¡¨æ ‡é¢˜
- **width**ï¼šå›¾è¡¨å®½åº¦ï¼ˆåƒç´ ï¼‰
- **height**ï¼šå›¾è¡¨é«˜åº¦ï¼ˆåƒç´ ï¼‰
- **show_markers**ï¼šæ˜¯å¦æ˜¾ç¤ºæ•°æ®ç‚¹æ ‡è®°
- **line_width**ï¼šçº¿æ¡å®½åº¦
- **show_grid**ï¼šæ˜¯å¦æ˜¾ç¤ºç½‘æ ¼
- **output_filename**ï¼šè¾“å‡ºæ–‡ä»¶å
- **output_dir**ï¼šè¾“å‡ºç›®å½•ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# æ¯”è¾ƒèµ·å§‹æ—¥æœŸ
comparison_start_date: "2024-09-18"

# éœ€è¦æ¯”è¾ƒçš„æŒ‡æ•°
indices_to_compare:
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "æœºå™¨äººæ¦‚å¿µ"
    display_name: "æœºå™¨äºº"
    
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "ç”µæ± æ¦‚å¿µ"
    display_name: "ç”µæ± "
    
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "åŠå¯¼ä½“æ¦‚å¿µ"
    display_name: "åŠå¯¼ä½“"
    
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "AIæ¦‚å¿µ"
    display_name: "AI"
    
  - pool_name: "é‡ç‚¹å…³æ³¨è‚¡æ± "
    concept_name: "æ–°èƒ½æº"
    display_name: "æ–°èƒ½æº"
    
  - pool_name: "é‡ç‚¹å…³æ³¨è‚¡æ± "
    concept_name: "åŒ»è¯"
    display_name: "åŒ»è¯"
    
  - pool_name: "æŒä»“è‚¡æ± "
    concept_name: "å½“å‰æŒä»“"
    display_name: "å½“å‰æŒä»“"

# å¯è§†åŒ–é…ç½®
visualization:
  title: "è‚¡æ± æŒ‡æ•°æ’åè¶‹åŠ¿"
  width: 1400
  height: 800
  show_markers: true
  line_width: 2
  show_grid: true
  output_filename: "index_ranking_comparison.html"
  output_dir: "reports"
```

## ğŸ“Š è¾“å‡ºè¯´æ˜

### 1. HTMLå¯è§†åŒ–é¡µé¢

**æ–‡ä»¶**ï¼š`reports/index_ranking_comparison.html`

**ç‰¹ç‚¹**ï¼š
- äº¤äº’å¼å›¾è¡¨ï¼Œå¯ç¼©æ”¾ã€å¹³ç§»ã€æ˜¾ç¤ºè¯¦ç»†æ•°æ®
- Yè½´åè½¬ï¼Œæ’å1æ˜¾ç¤ºåœ¨æœ€ä¸Šæ–¹
- ä¸åŒæŒ‡æ•°ä½¿ç”¨ä¸åŒé¢œè‰²åŒºåˆ†
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæ—¥æœŸã€æ’åç­‰ä¿¡æ¯
- æ”¯æŒå¯¼å‡ºä¸ºPNGå›¾ç‰‡

**ä½¿ç”¨æ–¹æ³•**ï¼š
- åŒå‡»æµè§ˆå™¨æ‰“å¼€HTMLæ–‡ä»¶
- ä½¿ç”¨é¼ æ ‡æ‹–åŠ¨ç¼©æ”¾å›¾è¡¨
- ç‚¹å‡»å›¾ä¾‹å¯éšè—/æ˜¾ç¤ºç‰¹å®šæŒ‡æ•°
- ç‚¹å‡»å³ä¸Šè§’ç›¸æœºå›¾æ ‡å¯¼å‡ºå›¾ç‰‡

### 2. CSVæ•°æ®æ–‡ä»¶

**æ–‡ä»¶**ï¼š`reports/index_ranking_data.csv`

**å†…å®¹**ï¼š
- `date`ï¼šäº¤æ˜“æ—¥æœŸ
- `{æŒ‡æ•°åç§°}`ï¼šè¯¥æŒ‡æ•°çš„æ’å
- `{æŒ‡æ•°åç§°}_value`ï¼šè¯¥æŒ‡æ•°çš„å½’ä¸€åŒ–å€¼
- `{æŒ‡æ•°åç§°}_pct`ï¼šè¯¥æŒ‡æ•°çš„æ¶¨è·Œå¹…ï¼ˆ%ï¼‰

**ç¤ºä¾‹**ï¼š
```csv
date,æœºå™¨äºº,AI,ç”µæ± ,æœºå™¨äºº_value,AI_value,ç”µæ± _value,æœºå™¨äºº_pct,AI_pct,ç”µæ± _pct
2024-09-18,2,1,3,100.00,100.00,100.00,0.00,0.00,0.00
2024-09-19,1,2,3,102.50,101.80,99.50,2.50,1.80,-0.50
...
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ¯”è¾ƒå¤§æ¦‚å¿µè‚¡æ± ä¸­çš„æŒ‡æ•°

**åœºæ™¯**ï¼šå¯¹æ¯”æœºå™¨äººã€AIã€ç”µæ± ã€åŠå¯¼ä½“å››ä¸ªæ¦‚å¿µçš„è¡¨ç°

**é…ç½®**ï¼š
```yaml
comparison_start_date: "2024-09-18"

indices_to_compare:
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "æœºå™¨äººæ¦‚å¿µ"
    display_name: "æœºå™¨äºº"
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "AIæ¦‚å¿µ"
    display_name: "AI"
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "ç”µæ± æ¦‚å¿µ"
    display_name: "ç”µæ± "
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "åŠå¯¼ä½“æ¦‚å¿µ"
    display_name: "åŠå¯¼ä½“"
```

### ç¤ºä¾‹2ï¼šè·¨è‚¡æ± æ¯”è¾ƒ

**åœºæ™¯**ï¼šå¯¹æ¯”ä¸åŒè‚¡æ± ä¸­çš„ä»£è¡¨æ€§æ¦‚å¿µ

**é…ç½®**ï¼š
```yaml
comparison_start_date: "2024-09-18"

indices_to_compare:
  - pool_name: "å¤§æ¦‚å¿µè‚¡æ± "
    concept_name: "AIæ¦‚å¿µ"
    display_name: "AI"
  - pool_name: "é‡ç‚¹å…³æ³¨è‚¡æ± "
    concept_name: "æ–°èƒ½æº"
    display_name: "æ–°èƒ½æº"
  - pool_name: "æŒä»“è‚¡æ± "
    concept_name: "å½“å‰æŒä»“"
    display_name: "å½“å‰æŒä»“"
```

### ç¤ºä¾‹3ï¼šè‡ªå®šä¹‰å¯è§†åŒ–æ ·å¼

**åœºæ™¯**ï¼šç”Ÿæˆæ›´å¤§å°ºå¯¸çš„å›¾è¡¨ç”¨äºæ¼”ç¤º

**é…ç½®**ï¼š
```yaml
visualization:
  title: "2024å¹´Q4è‚¡æ± æŒ‡æ•°æ’ååˆ†æ"
  width: 1920
  height: 1080
  show_markers: false  # ä¸æ˜¾ç¤ºæ•°æ®ç‚¹ï¼Œçº¿æ¡æ›´æ¸…æ™°
  line_width: 3
  show_grid: true
  output_filename: "q4_ranking_analysis.html"
```

## ğŸ”§ ç¨‹åºåŒ–ä½¿ç”¨

### Pythonè„šæœ¬ç¤ºä¾‹

```python
from dwad.analysis.index_comparator import IndexComparator
from dwad.visualization.ranking_visualizer import RankingVisualizer

# 1. åˆ›å»ºæ¯”è¾ƒå™¨
comparator = IndexComparator()

# 2. åŠ è½½æ•°æ®å¹¶è®¡ç®—æ’å
comparator.load_indices_data()
ranking_df = comparator.calculate_rankings()

# 3. ç”Ÿæˆå¯è§†åŒ–
visualizer = RankingVisualizer()
ranking_data = comparator.get_ranking_data_for_visualization()
visualizer.generate_html(ranking_data)

# 4. å¯¼å‡ºæ•°æ®
comparator.export_ranking_to_csv("my_ranking.csv")
```

### ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

```python
from dwad.analysis.index_comparator import IndexComparator

# æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
comparator = IndexComparator(
    comparison_config_path="config/my_comparison.yaml"
)

comparator.run()
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è¿è¡Œæ—¶æç¤º"æœªæ‰¾åˆ°æŒ‡æ•°æ•°æ®"

**åŸå› **ï¼šæŒ‡å®šçš„è‚¡æ± æˆ–æ¦‚å¿µåç§°ä¸å­˜åœ¨ï¼Œæˆ–æŒ‡æ•°æœªè®¡ç®—

**è§£å†³**ï¼š
1. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„`pool_name`å’Œ`concept_name`æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿å·²è¿è¡Œ`calculate_index.py`è®¡ç®—æŒ‡æ•°
3. æ£€æŸ¥`data/indices/`ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨å¯¹åº”çš„æŒ‡æ•°æ–‡ä»¶

### Q2: æ’åè¶‹åŠ¿å›¾æ˜¾ç¤ºå¼‚å¸¸

**åŸå› **ï¼šæ¯”è¾ƒèµ·å§‹æ—¥æœŸè®¾ç½®ä¸å½“ï¼Œå¯¼è‡´æŸäº›æŒ‡æ•°æ•°æ®ä¸è¶³

**è§£å†³**ï¼š
1. æ£€æŸ¥æ‰€æœ‰æŒ‡æ•°çš„èµ·å§‹æ—¥æœŸ
2. å°†`comparison_start_date`è®¾ç½®ä¸ºæ‰€æœ‰æŒ‡æ•°éƒ½æœ‰æ•°æ®çš„æ—¥æœŸ
3. æˆ–è®¾ç½®ä¸º`null`ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©

### Q3: å¦‚ä½•æ·»åŠ æˆ–åˆ é™¤è¦æ¯”è¾ƒçš„æŒ‡æ•°

**æ–¹æ³•**ï¼šä¿®æ”¹`config/index_comparison.yaml`ä¸­çš„`indices_to_compare`åˆ—è¡¨
- æ·»åŠ ï¼šåœ¨åˆ—è¡¨ä¸­å¢åŠ æ–°çš„æŒ‡æ•°é…ç½®
- åˆ é™¤ï¼šä»åˆ—è¡¨ä¸­ç§»é™¤å¯¹åº”çš„æŒ‡æ•°é…ç½®

### Q4: å¯è§†åŒ–é¡µé¢æ‰“ä¸å¼€

**åŸå› **ï¼šHTMLæ–‡ä»¶ç”Ÿæˆå¤±è´¥æˆ–è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
1. æ£€æŸ¥æ—¥å¿—è¾“å‡ºï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤`reports`ç›®å½•æ˜¯å¦å­˜åœ¨
3. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

### Q5: å¦‚ä½•ç†è§£æ’åæ•°å€¼

**è¯´æ˜**ï¼š
- æ’ååŸºäºæ¶¨è·Œå¹…è®¡ç®—
- **æ’å1**ï¼šæ¶¨å¹…æœ€å¤§ï¼ˆè¡¨ç°æœ€å¥½ï¼‰
- **æ’åè¶Šå¤§**ï¼šæ¶¨å¹…è¶Šå°æˆ–è·Œå¹…è¶Šå¤§
- æ’åä¼šéšç€æ—¶é—´å˜åŒ–è€Œå˜åŒ–

## ğŸ“ˆ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰æ’åè®¡ç®—é€»è¾‘

å¦‚éœ€ä¿®æ”¹æ’åè®¡ç®—æ–¹å¼ï¼ˆå¦‚åŸºäºæ³¢åŠ¨ç‡ã€å¤æ™®æ¯”ç‡ç­‰ï¼‰ï¼Œå¯ä»¥ä¿®æ”¹`index_comparator.py`ä¸­çš„`calculate_rankings`æ–¹æ³•ã€‚

### æ‰¹é‡ç”ŸæˆæŠ¥å‘Š

```python
from pathlib import Path
from dwad.analysis.index_comparator import IndexComparator
from dwad.visualization.ranking_visualizer import RankingVisualizer

configs = [
    "config/comparison_q1.yaml",
    "config/comparison_q2.yaml",
    "config/comparison_q3.yaml",
]

for config_path in configs:
    comparator = IndexComparator(config_path)
    comparator.run()
    
    visualizer = RankingVisualizer()
    data = comparator.get_ranking_data_for_visualization()
    
    output_name = Path(config_path).stem + "_ranking.html"
    visualizer.generate_html(data, f"reports/{output_name}")
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘è®¡åˆ’](../å¼€å‘è®¡åˆ’.md)
- [è‚¡æ± æŒ‡æ•°éªŒè¯æŠ¥å‘Š](./è‚¡æ± æŒ‡æ•°éªŒè¯æŠ¥å‘Š.md)
- [æŒ‡æ•°è®¡ç®—å¼‚å¸¸å¤„ç†è¯´æ˜](./æŒ‡æ•°è®¡ç®—å¼‚å¸¸å¤„ç†è¯´æ˜.md)
- [é…ç½®ç¤ºä¾‹æ–‡æ¡£](../examples/config_example.md)

## ğŸ‰ æ€»ç»“

è‚¡æ± æŒ‡æ•°æ¯”è¾ƒæ¨¡å—æä¾›äº†å®Œæ•´çš„æŒ‡æ•°å¯¹æ¯”åˆ†æåŠŸèƒ½ï¼š
- âœ… çµæ´»çš„é…ç½®ç³»ç»Ÿ
- âœ… æ™ºèƒ½çš„æ•°æ®å½’ä¸€åŒ–å’Œå¯¹é½
- âœ… å®æ—¶çš„æ’åè®¡ç®—
- âœ… ç¾è§‚çš„å¯è§†åŒ–å±•ç¤º
- âœ… ä¾¿æ·çš„æ•°æ®å¯¼å‡º

é€šè¿‡æœ¬æ¨¡å—ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å¯¹æ¯”åˆ†æå¤šä¸ªè‚¡æ± æŒ‡æ•°çš„è¡¨ç°ï¼Œå‘ç°å¼ºåŠ¿æ¦‚å¿µï¼Œè¾…åŠ©æŠ•èµ„å†³ç­–ã€‚
